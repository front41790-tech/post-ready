<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó</title>
  <style>
    body { font-family: Arial, sans-serif; background: #eef2f5; margin: 0; padding: 20px; }
    .wrap { max-width: 720px; margin: 0 auto; background: #fff; border-radius: 8px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
    .chat { height: 420px; overflow: auto; border: 1px solid #ddd; padding: 12px; border-radius: 6px; background: #fbfdff; }
    .msg { margin: 8px 0; max-width: 80%; padding: 10px; border-radius: 12px; }
    .user { background: #d1e7dd; margin-left: auto; text-align: right; }
    .bot { background: #f8d7da; margin-right: auto; text-align: left; }
    .controls { display: flex; gap: 8px; margin-top: 10px; }
    input[type=text] { flex: 1; padding: 10px; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 10px 12px; border-radius: 6px; border: none; background: #4caf50; color: #fff; cursor: pointer; }
  </style>
  <!-- Fuse.js -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
</head>
<body>
  <div class="wrap">
    <h2>‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô HTML ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</h2>
    <div id="chat" class="chat"></div>

    <div class="controls">
      <input id="q" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." />
      <button id="send">‡∏ñ‡∏≤‡∏°</button>
    </div>
  </div>

  <script>
    // ====== Q&A ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ======
    let qaDatabase = [
      { q: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ", a: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∏‡∏¢‡∏î‡πâ‡∏ß‡∏¢" },
      { q: "‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", a: "‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö" },
      { q: "‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ", a: "‡∏ú‡∏°‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ" },
      { q: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì", a: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö üòä" },
      { q: "‡∏ó‡∏≥‡πÑ‡∏£", a: "‡∏Å‡πá‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏´‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö" }
    ];

    // ====== ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage ======
    const STORAGE_KEY = "chatbot_logs_v1";
    let logs = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    qaDatabase = [...qaDatabase, ...logs];

    // ====== Fuse.js ======
    let fuseOptions = {
      keys: ["q"],
      threshold: 0.35,
      includeScore: true,
      ignoreLocation: true
    };
    let fuse = new Fuse(qaDatabase, fuseOptions);

    // ====== DOM ======
    const chatBox = document.getElementById("chat");
    const input = document.getElementById("q");
    const sendBtn = document.getElementById("send");

    function addMessage(text, cls) {
      const div = document.createElement("div");
      div.className = "msg " + cls;
      div.innerText = text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function saveLog(q, a) {
      logs.push({ q, a });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));
    }

    function findAnswer(q) {
      const result = fuse.search(q);
      if (result.length && result[0].score < 0.45) {
        return result[0].item.a;
      }
      return null;
    }

    function sendQuestion() {
      const q = input.value.trim();
      if (!q) return;
      input.value = "";
      addMessage(q, "user");

      let ans = findAnswer(q);
      if (!ans) {
        ans = "‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ ‡πÅ‡∏ï‡πà‡∏ú‡∏°‡∏à‡∏∞‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏±‡∏ö";
        saveLog(q, ans); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ
      }
      setTimeout(() => addMessage(ans, "bot"), 400);
    }

    sendBtn.addEventListener("click", sendQuestion);
    input.addEventListener("keydown", e => { if (e.key === "Enter") sendQuestion(); });
  </script>
</body>
</html>
